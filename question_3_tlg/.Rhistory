mutate(AESOC = factor(AESOC, levels = soc))
adae %>%
mutate(AESOC = factor(AESOC, levels = soc)) %>%
tidyr::pivot_wider(
id_cols   = c(USUBJID, ACTARM),
names_from  = AESOC,
values_from = flag,
values_fill = 0L
)
adae %>%
mutate(AESOC = factor(AESOC, levels = soc)) %>%
tidyr::pivot_wider(
id_cols   = c(USUBJID, ACTARM),
names_from  = AESOC,
values_from = flag,
values_fill = 0
)
adae <- adae %>%
filter(SAFFL == "Y") %>% # Filter safety population
distinct(USUBJID, ACTARM, AESOC, AETERM) %>%
mutate(flag = 1)
dae %>%
mutate(AESOC = factor(AESOC, levels = soc)) %>%
tidyr::pivot_wider(
id_cols   = c(USUBJID, ACTARM),
names_from  = AESOC,
values_from = flag,
values_fill = 0
)
adae %>%
mutate(AESOC = factor(AESOC, levels = soc)) %>%
tidyr::pivot_wider(
id_cols   = c(USUBJID, ACTARM),
names_from  = AESOC,
values_from = flag,
values_fill = 0
)
teae_wide <- adae %>%
mutate(AESOC = factor(AESOC, levels = soc)) %>%
tidyr::pivot_wider(
id_cols   = c(USUBJID, ACTARM),
names_from  = AESOC,
values_from = flag
)
teae_wide
taea <- adae %>%
filter(SAFFL == "Y") %>% # Filter safety population
distinct(USUBJID, ACTARM, AESOC, AETERM)
taea <- adae %>%
filter(SAFFL == "Y") %>% # Filter safety population
distinct(USUBJID, ACTARM, AESOC, AETERM)
# Load example datasets
adae <- pharmaverseadam::adae
adsl <- pharmaverseadam::adsl
taea <- adae %>%
filter(SAFFL == "Y") %>% # Filter safety population
distinct(USUBJID, ACTARM, AESOC, AETERM)
View(taea)
any_teae <- teae %>%
distinct(USUBJID, ACTARM) %>%
mutate(any_teae = 1L)
any_teae <- teae %>%
distinct(USUBJID, ACTARM) %>%
mutate(any_teae = 1)
taea <- adae %>%
filter(SAFFL == "Y") %>% # Filter safety population
distinct(USUBJID, ACTARM, AESOC, AETERM)
any_teae <- teae %>%
distinct(USUBJID, ACTARM) %>%
mutate(any_teae = 1)
teae <- adae %>%
filter(SAFFL == "Y") %>% # Filter safety population
distinct(USUBJID, ACTARM, AESOC, AETERM)
any_teae <- teae %>%
distinct(USUBJID, ACTARM) %>%
mutate(any_teae = 1)
View(any_teae)
adsl %>%
left_join(any_teae, by = c("USUBJID", "ACTARM")) %>%
subj_any <- adsl %>%
left_join(any_teae, by = c("USUBJID", "ACTARM"))
subj_any <- adsl %>%
left_join(any_teae, by = c("USUBJID", "ACTARM"))
View(subj_any)
subj_any <- adsl %>%
left_join(any_teae, by = c("USUBJID", "ACTARM")) %>%
select(USUBJID, ACTARM, any_teae)
subj_any <- adsl %>%
left_join(any_teae, by = c("USUBJID", "ACTARM")) %>%
select(USUBJID, ACTARM, any_teae) %>%
mutate(across(where(is.numeric), replace_na(.x, 0)))
adsl %>%
left_join(any_teae, by = c("USUBJID", "ACTARM")) %>%
select(USUBJID, ACTARM, any_teae)
subj_any <- adsl %>%
left_join(any_teae, by = c("USUBJID", "ACTARM")) %>%
select(USUBJID, ACTARM, any_teae) %>%
mutate(any_teae = ifelse(is.na(any_teae), 0, any_teae))
View(subj_any)
all_subj <- adsl %>%
left_join(any_teae, by = c("USUBJID", "ACTARM")) %>%
select(USUBJID, ACTARM, any_teae) %>%
mutate(any_teae = ifelse(is.na(any_teae), 0, any_teae))
tbl_trtemfl <- all_subj %>%
tbl_summary(
by = ACTARM,
include = any_teae,
type = all_dichotomous() ~ "dichotomous",
value = all_dichotomous() ~ 1,
statistic = all_dichotomous() ~ "{n} ({p}%)",
digits = all_dichotomous() ~ c(0, 1),
label = list(any_teae ~ "Any TEAE (TRTEMFL = 'Y')"),
missing = "no"
) %>%
add_overall(last = TRUE, col_label = "**Total**") %>%
modify_header(label ~ "**Summary**")
tbl_trtemfl
# ---- Table 1: Any TEAE (TRTEMFL = Y) ----
tbl_trtemfl <- all_subj %>%
tbl_summary(
by = ACTARM,
include = any_teae,
type = all_dichotomous() ~ "dichotomous",
value = all_dichotomous() ~ 1,
statistic = all_dichotomous() ~ "{n} ({p}%)",
digits = all_dichotomous() ~ c(0, 1),
label = list(any_teae ~ "Any TEAE (TRTEMFL = 'Y')"),
missing = "missing"
) %>%
add_overall(last = TRUE, col_label = "**Total**") %>%
modify_header(label ~ "**Summary**")
# ---- Table 1: Any TEAE (TRTEMFL = Y) ----
tbl_trtemfl <- all_subj %>%
tbl_summary(
by = ACTARM,
include = any_teae,
type = all_dichotomous() ~ "dichotomous",
value = all_dichotomous() ~ 1,
statistic = all_dichotomous() ~ "{n} ({p}%)",
digits = all_dichotomous() ~ c(0, 1),
label = list(any_teae ~ "Any TEAE (TRTEMFL = 'Y')"),
missing = "always"
) %>%
add_overall(last = TRUE, col_label = "**Total**") %>%
modify_header(label ~ "**Summary**")
tbl_trtemfl
all_subj %>%
tbl_summary(
by = ACTARM,
include = any_teae,
type = all_dichotomous() ~ "dichotomous",
value = all_dichotomous() ~ 1,
statistic = all_dichotomous() ~ "{n} ({p}%)",
digits = all_dichotomous() ~ c(0, 1),
label = list(any_teae ~ "Treatment-emergent AEs")
) %>%
add_overall(last = TRUE, col_label = "**Total**") %>%
modify_header(label ~ "**Summary**")
View(all_subj)
all_subj <- adsl %>%
left_join(any_teae, by = c("USUBJID", "ACTARM")) %>%
select(USUBJID, ACTARM, any_teae) %>%
mutate(any_teae = ifelse(is.na(any_teae), 0, any_teae)) %>%
filter(ACTARM != "Screen Failure")
all_subj %>%
tbl_summary(
by = ACTARM,
include = any_teae,
type = all_dichotomous() ~ "dichotomous",
value = all_dichotomous() ~ 1,
statistic = all_dichotomous() ~ "{n} ({p}%)",
digits = all_dichotomous() ~ c(0, 1),
label = list(any_teae ~ "Treatment-emergent AEs")
) %>%
add_overall(last = TRUE, col_label = "**Total**") %>%
modify_header(label ~ "**Summary**")
table(all_subj$ACTARM)
table(all_subj$any_teae)
adsl %>%
left_join(any_teae, by = c("USUBJID", "ACTARM")) %>%
select(USUBJID, ACTARM, any_teae)
any_teae <- teae %>%
distinct(USUBJID, ACTARM) %>%
mutate(any_teae = 1)
any_teae
any_teae <- teae %>%
distinct(USUBJID, ACTARM) %>%
mutate(any_teae = 1)
all_subj <- adsl %>%
left_join(any_teae, by = c("USUBJID", "ACTARM")) %>%
select(USUBJID, ACTARM, any_teae) %>%
mutate(any_teae = ifelse(is.na(any_teae), 0, any_teae)) %>%
filter(ACTARM != "Screen Failure")
# Create dataset with TEAEs
teae <- adae %>%
filter(SAFFL == "Y")# %>% # Filter safety population
# Create dataset with any TEAE indicator
any_teae <- teae %>%
distinct(USUBJID, ACTARM) %>%
mutate(any_teae = 1)
all_subj <- adsl %>%
left_join(any_teae, by = c("USUBJID", "ACTARM")) %>%
select(USUBJID, ACTARM, any_teae) %>%
mutate(any_teae = ifelse(is.na(any_teae), 0, any_teae)) %>%
filter(ACTARM != "Screen Failure")
all_subj %>%
tbl_summary(
by = ACTARM,
include = any_teae,
type = all_dichotomous() ~ "dichotomous",
value = all_dichotomous() ~ 1,
statistic = all_dichotomous() ~ "{n} ({p}%)",
digits = all_dichotomous() ~ c(0, 1),
label = list(any_teae ~ "Treatment-emergent AEs")
) %>%
add_overall(last = TRUE, col_label = "**Total**") %>%
modify_header(label ~ "**Summary**")
# Create dataset with TEAEs
teae <- adae %>%
filter(SAFFL == "Y") %>% # Filter safety population
distinct(USUBJID, ACTARM, AESOC, AETERM)
# Create dataset with any TEAE indicator
any_teae <- teae %>%
distinct(USUBJID, ACTARM) %>%
mutate(any_teae = 1)
all_subj <- adsl %>%
left_join(any_teae, by = c("USUBJID", "ACTARM")) %>%
select(USUBJID, ACTARM, any_teae) %>%
mutate(any_teae = ifelse(is.na(any_teae), 0, any_teae)) %>%
filter(ACTARM != "Screen Failure")
# ---- Table 1: Any TEAE (TRTEMFL = Y) ----
tbl_trtemfl <- all_subj %>%
tbl_summary(
by = ACTARM,
include = any_teae,
statistic = all_dichotomous() ~ "{n} ({p}%)",
label = list(any_teae ~ "Treatment-emergent AEs")
) %>%
modify_header(label ~ "**Summary**")
tbl_trtemfl
# ---- Table 1: Any TEAE (TRTEMFL = Y) ----
tbl_trtemfl <- all_subj %>%
tbl_summary(
by = ACTARM,
include = any_teae,
statistic = all_dichotomous() ~ "{n} ({p}%)",
label = list(any_teae ~ "Treatment-emergent AEs")
) %>%
modify_header(label ~ "**Primary System Organ Class Reported Term for the Adverse Event**")
tbl_trtemfl
# ---- Table 1: Any TEAE (TRTEMFL = Y) ----
tbl_trtemfl <- all_subj %>%
tbl_summary(
by = ACTARM,
include = any_teae,
statistic = all_dichotomous() ~ "{n} ({p}%)",
label = list(any_teae ~ "Treatment-emergent AEs")
) %>%
modify_header(label ~ "**Primary System Organ Class \n  Reported Term for the Adverse Event**")
tbl_trtemfl
# ---- Table 1: Any TEAE (TRTEMFL = Y) ----
tbl_trtemfl <- all_subj %>%
tbl_summary(
by = ACTARM,
include = any_teae,
statistic = all_dichotomous() ~ "{n} ({p}%)",
label = list(any_teae ~ "Treatment-emergent AEs")
) %>%
modify_header(label ~ "**Primary System Organ Class \\n  Reported Term for the Adverse Event**")
tbl_trtemfl
# ---- Table 1: Any TEAE (TRTEMFL = Y) ----
tbl_trtemfl <- all_subj %>%
tbl_summary(
by = ACTARM,
include = any_teae,
statistic = all_dichotomous() ~ "{n} ({p}%)",
label = list(any_teae ~ "Treatment-emergent AEs")
) %>%
modify_header(label ~ "**Primary System Organ Class \n  Reported Term for the Adverse Event**")
tbl_trtemfl
# ---- Table 1: Any TEAE (TRTEMFL = Y) ----
tbl_trtemfl <- all_subj %>%
tbl_summary(
by = ACTARM,
include = any_teae,
statistic = all_dichotomous() ~ "{n} ({p}%)",
label = list(any_teae ~ "Treatment-emergent AEs")
) %>%
modify_header(label ~ "**Primary System Organ Class Reported Term for the Adverse Event**")
teae %>%
filter(!is.na(AESOC))
teae
teae %>%
distinct(USUBJID, ACTARM, AESOC)
teae
teae %>%
distinct(USUBJID, ACTARM, AESOC)
soc_lvl <- adae %>%
distinct(USUBJID, AESOC) %>%
count(AESOC, name = "total") %>%
arrange(desc(total)) %>%
pull(AESOC)
teae %>%
distinct(USUBJID, ACTARM, AESOC) %>%
mutate(flag = 1L, AESOC = factor(AESOC, levels = soc_lvl))
teae %>%
distinct(USUBJID, ACTARM, AESOC) %>%
mutate(flag = 1, AESOC = factor(AESOC, levels = soc_lvl))
teae_soc_wide <- teae %>%
distinct(USUBJID, ACTARM, AESOC) %>%
mutate(flag = 1,
AESOC = factor(AESOC, levels = soc_lvl)) %>%
pivot_wider(
id_cols = c(USUBJID, ACTARM),
names_from = AESOC,
values_from = flag,
values_fill = 0
)
library(tidyverse)
teae_soc_wide <- teae %>%
distinct(USUBJID, ACTARM, AESOC) %>%
mutate(flag = 1,
AESOC = factor(AESOC, levels = soc_lvl)) %>%
pivot_wider(
id_cols = c(USUBJID, ACTARM),
names_from = AESOC,
values_from = flag,
values_fill = 0
)
teae_soc_wide
teae_soc_wide <- teae %>%
distinct(USUBJID, ACTARM, AESOC) %>%
mutate(flag = 1,
AESOC = factor(AESOC, levels = soc_lvl))
soc <- teae %>%
distinct(USUBJID, ACTARM, AESOC) %>%
mutate(flag = 1,
AESOC = factor(AESOC, levels = soc_lvl))
soc
soc %>%
select(-USUBJID) %>%
tbl_summary(
by = AESOC,
statistic = all_dichotomous() ~ "{n} ({p}%)",
label = list(everything() ~ "Patients with TEAE by SOC")
) %>%
modify_header(label ~ "**Primary System Organ Class Reported Term for the Adverse Event**")
tbl_soc <- soc %>%
select(-USUBJID) %>%
tbl_summary(
by = ACTARM,
statistic = all_dichotomous() ~ "{n} ({p}%)",
label = list(everything() ~ "Patients with TEAE by SOC")
) %>%
modify_header(label ~ "**Primary System Organ Class Reported Term for the Adverse Event**")
soc %>%
select(-USUBJID) %>%
tbl_summary(
by = ACTARM,
statistic = all_dichotomous() ~ "{n} ({p}%)",
label = list(everything() ~ "Patients with TEAE by SOC")
) %>%
modify_header(label ~ "**Primary System Organ Class Reported Term for the Adverse Event**")
soc <- teae %>%
distinct(USUBJID, ACTARM, AESOC) %>%
mutate(AESOC = factor(AESOC, levels = soc_lvl))
tbl_soc <- soc %>%
select(-USUBJID) %>%
tbl_summary(
by = ACTARM,
statistic = all_dichotomous() ~ "{n} ({p}%)"
) %>%
modify_header(label ~ "**Primary System Organ Class Reported Term for the Adverse Event**")
soc <- teae %>%
distinct(USUBJID, ACTARM, AESOC) %>%
mutate(AESOC = factor(AESOC, levels = soc_lvl))
oc %>%
select(-USUBJID) %>%
tbl_summary(
by = ACTARM,
statistic = all_dichotomous() ~ "{n} ({p}%)"
) %>%
modify_header(label ~ "**Primary System Organ Class Reported Term for the Adverse Event**")
soc %>%
select(-USUBJID) %>%
tbl_summary(
by = ACTARM,
statistic = all_dichotomous() ~ "{n} ({p}%)"
) %>%
modify_header(label ~ "**Primary System Organ Class Reported Term for the Adverse Event**")
adae$AETERM
View(adae)
adae %>%
select(USUBJID, ACTARM, AESOC, AETERM, TRTEMFL, SAFFL)
View(adae %>%
select(USUBJID, ACTARM, AESOC, AETERM, TRTEMFL, SAFFL)
)
adae_wide <- adae %>%
pivot_wider(names_from = AESOC,
values_from = AETERM)
View(adae_wide)
# Create dataset with TEAEs
teae <- adae %>%
filter(SAFFL == "Y") %>% # Filter safety population
distinct(USUBJID, ACTARM, AESOC, AETERM)
adae_wide <- teae %>%
pivot_wider(names_from = AESOC,
values_from = AETERM)
View(adae_wide)
adae_wide <- teae %>%
pivot_wider(names_from = AESOC,
values_from = AETERM,
values_fill = NA_Character_)
adae_wide <- teae %>%
pivot_wider(names_from = AESOC,
values_from = AETERM,
values_fill = "NA_Character_")
adae_wide <- teae %>%
pivot_wider(names_from = AESOC,
values_from = AETERM,
values_fill = 0)
adae_wide <- teae %>%
pivot_wider(names_from = AESOC,
values_from = AETERM,
values_fill = 0L)
adae_wide <- teae %>%
pivot_wider(names_from = AESOC,
values_from = AETERM,
values_fill = 0)
adae_wide <- teae %>%
pivot_wider(names_from = AESOC,
values_from = AETERM,
values_fill = "")
adae_wide <- teae %>%
pivot_wider(names_from = AESOC,
values_from = AETERM)
View(adae_wide)
soc <- teae %>%
mutate(AESOC = factor(AESOC, levels = soc_lvl)) %>%
pivot_wider(
names_from = AESOC,
values_from = AETERM,
values_fn = length,
values_fill = 0
)
View(soc)
soc <- teae %>%
mutate(AESOC = factor(AESOC, levels = soc_lvl)) %>%
pivot_wider(
names_from = AESOC,
values_from = AETERM,
id_expand = TRUE
)
View(soc)
# Create dataset with TEAEs
teae <- adae %>%
filter(SAFFL == "Y") %>% # Filter safety population
distinct(USUBJID, ACTARM, AESOC, AETERM)
tbl <- adae %>%
tbl_hierarchical(
variables = c(AESOC, AETERM),
by = ACTARM,
id = USUBJID,
denominator = adsl,
overall_row = TRUE,
label = "..ard_hierarchical_overall.." ~ "Any SAE"
)
library(gtsummary)
tbl <- adae %>%
tbl_hierarchical(
variables = c(AESOC, AETERM),
by = ACTARM,
id = USUBJID,
denominator = adsl,
overall_row = TRUE,
label = "..ard_hierarchical_overall.." ~ "Any SAE"
)
install.library("gtsummary")
install_library("gtsummary")
install.packages("gtsummary")
tbl_hierchical()
tbl <- adae %>%
tbl_hierarchical(
variables = c(AESOC, AETERM),
by = ACTARM,
id = USUBJID,
denominator = adsl,
overall_row = TRUE,
label = "..ard_hierarchical_overall.." ~ "Any SAE"
)
library(dplyr)
tbl <- adae %>%
tbl_hierarchical(
variables = c(AESOC, AETERM),
by = ACTARM,
id = USUBJID,
denominator = adsl,
overall_row = TRUE,
label = "..ard_hierarchical_overall.." ~ "Any SAE"
)
?tbl_hierarchical
tbl <- adae %>%
tbl_hierarchical(
variables = c(AESOC, AETERM),
by = ACTARM,
id = USUBJID,
denominator = adsl,
overall_row = TRUE,
label = "..ard_hierarchical_overall.." ~ "Any SAE"
)
tbl
version()
