txt <- '
"Emirates","Customer_names","Purchase_date","Amount"
"Dubai"," Huda","14-02-2027","143"
"Sharjah"," Huda","27-03-2017","5$6"
"Sharjah","Farhat","13-04-2017","1%57"
"Dubai"," Huda","04-06-2017","197"
"Sharjah","Farhat","05-06-2017","54"
"Dubai"," Huda","09-14-2017","148"
"Dubai","Najiyya","27-09-2017","#153"
"Dubai","Farhat","05-10-2017","195"
"Abu Dhabi"," Huda","21-10-2017","93"
"Dubai","Najiyya","31-10-2017","90"
'
df_data <- read.csv(text = txt, stringsAsFactors = FALSE)
df_data
df_data
df_data$Purchase_date <- as.Date(df_data$Purchase_date, format = "%d-%m-%Y")
df_data$Purchase_date
clean_date <- dmy(df_data$Purchase_date)
clean_date
df_data$Amount <- as.numeric(gsub("[^0-9]", "", df_data$Amount))
df_data$Amount
df_data$Purchase_date <- as.Date(df_data$Purchase_date, format = "%d-%m-%Y")
df_data$Purchase_date
txt <- '
"Emirates","Customer_names","Purchase_date","Amount"
"Dubai"," Huda","14-02-2027","143"
"Sharjah"," Huda","27-03-2017","5$6"
"Sharjah","Farhat","13-04-2017","1%57"
"Dubai"," Huda","04-06-2017","197"
"Sharjah","Farhat","05-06-2017","54"
"Dubai"," Huda","09-14-2017","148"
"Dubai","Najiyya","27-09-2017","#153"
"Dubai","Farhat","05-10-2017","195"
"Abu Dhabi"," Huda","21-10-2017","93"
"Dubai","Najiyya","31-10-2017","90"
'
df_data <- read.csv(text = txt, stringsAsFactors = FALSE)
df_data$Amount <- as.numeric(gsub("[^0-9]", "", df_data$Amount))
as.Date(df_data$Purchase_date, format = "%d-%m-%Y")
as.Date(df_data$Purchase_date)
as.Date(df_data$Purchase_date, format = "%Y-%m-%d")
df_data$Purchase_date
as.Date(df_data$Purchase_date, format = "%d-%m-%Y")
format(as.Date(df_data$Purchase_date, format = "%d-%m-%Y"), "%Y/%m/%d")
format(as.Date(df_data$Purchase_date, format = "%d-%m-%Y"), "%d%m%Y")
format(as.Date(df_data$Purchase_date, format = "%d-%m-%Y"), "%d-%m%-Y")
format(as.Date(df_data$Purchase_date, format = "%d-%m-%Y"), "%d-%m%-%Y")
df_data$Purchase_date <- format(as.Date(df_data$Purchase_date, format = "%d-%m-%Y"), "%d-%m%-%Y")
library(stringr)
library(lubridate)
library(dplyr)
library(stringr)
str_replace(df_data$Purchase_date, "20[234]7", "2017")
df_data$Purchase_date
df_data$Purchase_date <- str_replace(df_data$Purchase_date, "20[234]7", "2017")
df_data$Purchase_date
txt <- '
"Emirates","Customer_names","Purchase_date","Amount"
"Dubai"," Huda","14-02-2027","143"
"Sharjah"," Huda","27-03-2017","5$6"
"Sharjah","Farhat","13-04-2017","1%57"
"Dubai"," Huda","04-06-2017","197"
"Sharjah","Farhat","05-06-2017","54"
"Dubai"," Huda","09-14-2017","148"
"Dubai","Najiyya","27-09-2017","#153"
"Dubai","Farhat","05-10-2017","195"
"Abu Dhabi"," Huda","21-10-2017","93"
"Dubai","Najiyya","31-10-2017","90"
'
format(as.Date(df_data$Purchase_date, format = "%d-%m-%Y"), "%d-%m%-%Y")
df_data$Purchase_date
df_data <- read.csv(text = txt, stringsAsFactors = FALSE)
df_data$Purchase_date
format(as.Date(df_data$Purchase_date, format = "%d-%m-%Y"), "%d-%m%-%Y")
df_data$Purchase_date <- ifelse(is.na(format(as.Date(df_data$Purchase_date, format = "%d-%m-%Y"), "%d-%m%-%Y")),
"09-14-2017",
format(as.Date(df_data$Purchase_date, format = "%d-%m-%Y"), "%d-%m%-%Y"))
df_data$Purchase_date
df_data <- read.csv(text = txt, stringsAsFactors = FALSE)
df_data$Amount <- as.numeric(gsub("[^0-9]", "", df_data$Amount))
df_data$Purchase_date <- ifelse(is.na(format(as.Date(df_data$Purchase_date, format = "%d-%m-%Y"), "%d-%m%-%Y")),
df_data$Purchase_date, format(as.Date(df_data$Purchase_date, format = "%d-%m-%Y"), "%d-%m%-%Y"))
df_data$Purchase_date
df_data$Purchase_date <- str_replace(df_data$Purchase_date, "20[234]7", "2017")
df_data$Purchase_date
#find number of days
first_day <- as.Date("31-12-2017", format = '%d-%m-%Y')
first_day
df_data <- df_data %>%
mutate(num_days = as.numeric(Purchase_date - first_day))
first_day
str(first_day)
df_data %>%
mutate(num_days = as.numeric(Purchase_date - first_day))
df_data <- df_data %>%
mutate(num_days = as.numeric(as.Date(Purchase_date) - first_day))
df_data
df_data <- df_data %>%
mutate(num_days = as.numeric(as.Date(Purchase_date, format = '%d-%m-%Y') - first_day))
df_data
df_data <- df_data %>%
mutate(num_days = as.numeric(first_day - as.Date(Purchase_date, format = '%d-%m-%Y')))
df_data
df_data %>%
mutate(num_days = as.numeric(first_day - as.Date(Purchase_date, format = '%d-%m-%Y')))
df_data <- df_data %>%
mutate(num_days = as.numeric(first_day - as.Date(Purchase_date, format = '%d-%m-%Y'))) %>%
group_by(Customer_names) %>%
summarize(total_revenue = sum(Amount))
df_data
df_data <- df_data %>%
mutate(num_days = as.numeric(first_day - as.Date(Purchase_date, format = '%d-%m-%Y'))) %>%
group_by(Emirates, Customer_names) %>%
summarize(total_revenue = sum(Amount)
)
df_data <- df_data %>%
mutate(num_days = as.numeric(first_day - as.Date(Purchase_date, format = '%d-%m-%Y'))) %>%
group_by(Emirates, Customer_names) %>%
summarize(total_revenue = sum(Amount))
df_data
df_data <- read.csv(text = txt, stringsAsFactors = FALSE)
df_data$Amount <- as.numeric(gsub("[^0-9]", "", df_data$Amount))
df_data$Purchase_date <- ifelse(is.na(format(as.Date(df_data$Purchase_date, format = "%d-%m-%Y"), "%d-%m%-%Y")),
df_data$Purchase_date, format(as.Date(df_data$Purchase_date, format = "%d-%m-%Y"), "%d-%m%-%Y"))
df_data$Purchase_date <- str_replace(df_data$Purchase_date, "20[234]7", "2017")
#find number of days
first_day <- as.Date("31-12-2017", format = '%d-%m-%Y')
df_data <- df_data %>%
mutate(num_days = as.numeric(first_day - as.Date(Purchase_date, format = '%d-%m-%Y'))) %>%
group_by(Emirates, Customer_names) %>%
summarize(total_revenue = sum(Amount))
df_data
df_data %>%
mutate(num_days = as.numeric(first_day - as.Date(Purchase_date, format = '%d-%m-%Y')),
total_months = num_days/30)
df_data <- read.csv(text = txt, stringsAsFactors = FALSE)
df_data$Amount <- as.numeric(gsub("[^0-9]", "", df_data$Amount))
df_data$Purchase_date <- ifelse(is.na(format(as.Date(df_data$Purchase_date, format = "%d-%m-%Y"), "%d-%m%-%Y")),
df_data$Purchase_date, format(as.Date(df_data$Purchase_date, format = "%d-%m-%Y"), "%d-%m%-%Y"))
df_data$Purchase_date <- str_replace(df_data$Purchase_date, "20[234]7", "2017")
#find number of days
first_day <- as.Date("31-12-2017", format = '%d-%m-%Y')
df_data %>%
mutate(num_days = as.numeric(first_day - as.Date(Purchase_date, format = '%d-%m-%Y')),
total_months = num_days/30)
df_data %>%
mutate(num_days = as.numeric(first_day - as.Date(Purchase_date, format = '%d-%m-%Y')),
total_months = num_days/30) %>%
group_by(Emirates, Customer_names) %>%
summarize(total_revenue = sum(Amount))
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date))
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(first_order_date - Purchase_date))
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(as.Date(first_order_date) - Purchase_date))
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(as.Date(first_order_date) - as.Date(Purchase_date)))
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(as.Date(first_order_date)=,format = '%d-%m-%Y') - as.Date(Purchase_date,format = '%d-%m-%Y')))
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(as.Date(first_order_date)=,format = '%d-%m-%Y') - as.Date(Purchase_date,format = '%d-%m-%Y'))
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(as.Date(first_order_date ,format = '%d-%m-%Y') - as.Date(Purchase_date,format = '%d-%m-%Y')))
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(first_day - as.Date(Purchase_date,format = '%d-%m-%Y')))
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(first_order_date - first_day))
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(as.Date(first_order_date) - first_day))
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(as.Date(first_order_date) - as.Date(first_day)))
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(as.Date(first_day) - as.Date(first_order_date)))
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(as.Date(first_day, format = '%d-%m-%Y') - as.Date(first_order_date,format = '%d-%m-%Y')))
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(as.Date(first_day, format = '%d-%m-%Y') - as.Date(first_order_date,format = '%d-%m-%Y')))
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(as.Date(first_day, format = '%d-%m-%Y') - as.Date(first_order_date,format = '%d-%m-%Y')),
total_months = number_of_days/30)
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(as.Date(first_day, format = '%d-%m-%Y') - as.Date(first_order_date,format = '%d-%m-%Y')),
total_months = number_of_days/30)
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(as.Date(first_day, format = '%d-%m-%Y') - as.Date(first_order_date,format = '%d-%m-%Y')),
total_months = number_of_days/30,
total_revenyue = sum(Amount))
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(as.Date(first_day, format = '%d-%m-%Y') - as.Date(first_order_date,format = '%d-%m-%Y')),
total_months = number_of_days/30,
total_revenue = sum(Amount),
ARM = total_revenue/total_months)
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(as.Date(first_day, format = '%d-%m-%Y') - as.Date(first_order_date,format = '%d-%m-%Y')),
total_months = number_of_days/30,
total_revenue = sum(Amount),
ARM = total_revenue/total_months,
ARPM = ARM*12)
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(as.Date(first_day, format = '%d-%m-%Y') - as.Date(first_order_date,format = '%d-%m-%Y')),
total_months = number_of_days/30,
total_revenue = sum(Amount),
ARM = total_revenue/total_months,
ARPM = ARM*12) %>%
ungroup() %>%
group_by(Emirates) %>%
summarize(total_estimates_ARPM = sum(ARPM))
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(as.Date(first_day, format = '%d-%m-%Y') - as.Date(first_order_date,format = '%d-%m-%Y')),
total_months = number_of_days/30,
total_revenue = sum(Amount),
ARM = total_revenue/total_months,
ARPM = ARM*12) %>%
ungroup() %>%
group_by(Emirates) %>%
summarize(total_estimates_ARPM = sum(ARPM)) %>%
arrange(desc(total_estimates_ARPM)) %>%
slice_max(n=2)
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(as.Date(first_day, format = '%d-%m-%Y') - as.Date(first_order_date,format = '%d-%m-%Y')),
total_months = number_of_days/30,
total_revenue = sum(Amount),
ARM = total_revenue/total_months,
ARPM = ARM*12) %>%
ungroup() %>%
group_by(Emirates) %>%
summarize(total_estimates_ARPM = sum(ARPM)) %>%
arrange(desc(total_estimates_ARPM)) %>%
slice_head(n=2)
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(as.Date(first_day, format = '%d-%m-%Y') - as.Date(first_order_date,format = '%d-%m-%Y')),
total_months = number_of_days/30,
total_revenue = sum(Amount),
ARM = total_revenue/total_months,
ARPM = ARM*12) %>%
ungroup() %>%
group_by(Emirates) %>%
summarize(total_estimates_ARPM = sum(ARPM)) %>%
arrange(desc(total_estimates_ARPM)) %>%
slice_head(n=2) %>%
mutate(inc_rev = total_estimates_ARPM *1.10)
df_data %>%
group_by(Emirates, Customer_names) %>%
summarize(first_order_date = min(Purchase_date),
number_of_days = as.numeric(as.Date(first_day, format = '%d-%m-%Y') - as.Date(first_order_date,format = '%d-%m-%Y')),
total_months = number_of_days/30,
total_revenue = sum(Amount),
ARM = total_revenue/total_months,
ARPM = ARM*12) %>%
ungroup() %>%
group_by(Emirates) %>%
summarize(total_estimates_ARPM = sum(ARPM)) %>%
arrange(desc(total_estimates_ARPM)) %>%
slice_head(n=2) %>%
mutate(inc_rev = round(total_estimates_ARPM *1.10,1))
df_data$Purchase_date <- gsub(df_data$Purchase_date, "20[234]7", "2017")
gsub(df_data$Purchase_date, "20[234]7", "2017")
df_data <- read.csv(text = txt, stringsAsFactors = FALSE)
df_data$Amount <- as.numeric(gsub("[^0-9]", "", df_data$Amount))
df_data$Purchase_date <- ifelse(is.na(format(as.Date(df_data$Purchase_date, format = "%d-%m-%Y"), "%d-%m%-%Y")),
df_data$Purchase_date, format(as.Date(df_data$Purchase_date, format = "%d-%m-%Y"), "%d-%m%-%Y"))
gsub(df_data$Purchase_date, "20[234]7", "2017")
df_data$Purchase_date <- #str_replace(df_data$Purchase_date, "20[234]7", "2017")
gsub("20[234]7", "2017", df_data$Purchase_date)
df_data$Purchase_date
df_data <- read.csv(text = txt, stringsAsFactors = FALSE)
df_data$Purchase_date
df_data %>%
summarise(across(everything(), ~ sum(is.na(.x))))
df_data %>%
summarize(across(everything(), ~ sum(is.na(.x))))
df_data %>%
pivot_wider(names_from = Emirates, values_from = Amount, values_fill = 0)
library(tidyr)
df_data %>%
pivot_wider(names_from = Emirates, values_from = Amount, values_fill = 0)
df_data %>%
pivot_wider(names_from = Emirates, values_from = Amount, values_fill = '0')
df_data
library(stringr)
ls(stringr)
ls(package:stringr)
df_data
df_data %>%
slice(n=3)
df_data %>%
slice(3)
df_data %>%
slice(9)
df_data %>%
slice(9)
txt <- '
"order_id","date","revenue"
"id01",2019-01-04,177
"id02",2019-10-10,332
"id03",2019-06-15,263
"id04",2018-06-02,492
"id05",2018-06-08,159
"id06",2020-10-03,272
"id07",2019-02-03,51
"id08",2018-07-17,430
"id09",2020-02-18,494
"id10",2018-12-16,112
'
data_df <- read.csv(text = txt, stringsAsFactors = FALSE)
data_df
data_df %>%
mutate(Year = year(as.Date(date)),
Months = format(as.Date(date), '%b'),
month_num = format(as.Date(date), '%m'))
data_df <- data_df %>%
mutate(Year = year(as.Date(date)),
Months = format(as.Date(date), '%b'),
month_num = format(as.Date(date), '%m'))
data_df %>%
group_by(Year, Months, month_num) %>%
summarize(revenue = sum(revenue))
data_df %>%
group_by(Year, Months, month_num) %>%
summarize(revenue = sum(revenue)) %>%
arrange(month_num)
data_df %>%
group_by(Year, Months, month_num) %>%
summarize(revenue = sum(revenue)) %>%
arrange(month_num, Year)
data_df %>%
group_by(Year, Months, month_num) %>%
summarize(revenue = sum(revenue))
data_df %>%
group_by(Year, Months, month_num) %>%
summarize(revenue = sum(revenue)) %>%
pivot_wider(names_from = Months, values_from = revenue, values_fill = 0)
data_df %>%
group_by(Year, Months, month_num) %>%
summarize(revenue = sum(revenue)) %>%
arrange(month_num) %>%
pivot_wider(names_from = Months, values_from = revenue, values_fill = 0)
data_df %>%
group_by(Year, Months, month_num) %>%
summarize(revenue = sum(revenue)) %>%
arrange(month_num) %>%
select(-month_num) %>%
pivot_wider(names_from = Months, values_from = revenue, values_fill = 0)
data_df %>%
group_by(Year, Months, month_num) %>%
summarize(revenue = sum(revenue)) %>%
arrange(month_num) %>%
select(-month_num) %>%
pivot_wider(names_from = Months, values_from = revenue, values_fill = 0) %>%
arrange(Year)
df_wide %>%
ungroup() %>%
summarize(across(everything(), mean))
df_wide <- data_df %>%
group_by(Year, Months, month_num) %>%
summarize(revenue = sum(revenue)) %>%
arrange(month_num) %>%
select(-month_num) %>%
pivot_wider(names_from = Months, values_from = revenue, values_fill = 0) %>%
arrange(Year)
df_wide %>%
summarize(across(everything(), mean))
df_wide %>%
summarize(across(everything(), mean))
df_wide %>%
summarize(across(everything(), ~mean))
df_wide %>%
summarize(across(everything(), ~mean(.x)))
df_wide %>%
ungroup() %>%
summarize(across(everything(), ~mean(.x)))
df_wide %>%
ungroup() %>%
summarize(across(everything(-Year), ~mean(.x)))
df_wide %>%
ungroup() %>%
summarize(across(-Year, ~mean(.x)))
df_wide %>%
ungroup() %>%
summarize(across(-Year, ~mean(.x))) %>%
mutate(Year = "Mean")
df_wide %>%
ungroup() %>%
summarize(across(-Year, ~mean(.x))) %>%
mutate(Year = "Mean") %>%
relocate(Year,1)
mean_cal <- df_wide %>%
ungroup() %>%
summarize(across(-Year, ~mean(.x))) %>%
mutate(Year = "Mean") %>%
relocate(Year,1)
rbind(df_wide, mean_cal)
df_wide
df_wide$Year <- as.character(df_wide$Year)
mean_cal <- df_wide %>%
ungroup() %>%
summarize(across(-Year, ~mean(.x))) %>%
mutate(Year = "Mean") %>%
relocate(Year,1)
rbind(df_wide, mean_cal)
# Load libraries
library(pharmaverseadam)
library(gtsummary)
library(dplyr)
library(tidyverse)
# Load example datasets
adae <- pharmaverseadam::adae
adsl <- pharmaverseadam::adsl
# Create dataset with TEAEs
teae <- adae %>%
filter(SAFFL == "Y") %>% # Filter safety population
distinct(USUBJID, ACTARM, AESOC, AETERM)
tbl <- adae %>%
tbl_hierarchical(
variables = c(AESOC, AETERM),
by = ACTARM,
id = USUBJID,
denominator = adsl,
overall_row = TRUE,
label = "..ard_hierarchical_overall.." ~ "Any SAE"
)
tbl
tbl <- adae %>%
tbl_hierarchical(
variables = c(AESOC, AETERM),
by = ACTARM,
id = USUBJID,
denominator = adsl,
overall_row = TRUE,
label = "..ard_hierarchical_overall.." ~ "Primary System Organ Class Reported Term for the Adverse Event"
)
tbl <- adae %>%
tbl_hierarchical(
variables = c(AESOC, AETERM),
by = ACTARM,
id = USUBJID,
denominator = adsl,
overall_row = TRUE,
label = "..ard_hierarchical_overall.." ~ "Primary System Organ Class Reported Term for the Adverse Event"
)
tbl
tbl <- teae %>%
tbl_hierarchical(
variables = c(AESOC, AETERM),
by = ACTARM,
id = USUBJID,
denominator = adsl,
overall_row = TRUE,
label = "..ard_hierarchical_overall.." ~ "Primary System Organ Class Reported Term for the Adverse Event"
)
tbl
getwd()
setwd("~/Documents/GitHub/coding_assessment/question_3_tlg")
tbl %>%
as_flex_table() %>%
flextable::save_as_docx(path = "teae_summary_table.docx")
tbl %>%
as_flex_table() %>%
flextable::save_as_docx(path = "teae_summary_table.html")
tbl %>%
as_flex_table() %>%
flextable::save_as_html(path = "teae_summary_table.html")
# create log
sink("01_create_ae_summary_table.txt")
source("~/Documents/GitHub/coding_assessment/question_3_tlg/01_create_ae_summary_table.R", echo = TRUE)
